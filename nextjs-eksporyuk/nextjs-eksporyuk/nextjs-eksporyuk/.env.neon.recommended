# ============================================
# NEON POSTGRESQL - PRODUCTION RECOMMENDED
# ============================================
#
# Neon Pooled Connection (FAST, No Cold Start)
# Get from: https://console.neon.tech/app/projects/[project-id]
# 
# IMPORTANT: Use "Pooled connection" bukan "Direct connection"
#

# POOLED Connection String (RECOMMENDED)
DATABASE_URL="postgresql://[username]:[password]@[hostname]/[database]?pgbouncer=true&connect_timeout=15"

# Alternative: Direct + Connection Limit (if pooled not available)
# DATABASE_URL="postgresql://[username]:[password]@[hostname]/[database]?connection_limit=10&connect_timeout=10"

# Direct Connection (for migrations only)
DIRECT_URL="postgresql://[username]:[password]@[hostname]/[database]"

# ============================================
# PRISMA CONNECTION POOL SETTINGS
# ============================================

# Maximum connection pool size (default: 10)
# Neon free tier: max 100 connections
# Set to 5-10 untuk Vercel serverless
DATABASE_CONNECTION_LIMIT=10

# Connection timeout (seconds)
DATABASE_CONNECT_TIMEOUT=10

# Pool timeout (milliseconds)
DATABASE_POOL_TIMEOUT=20000

# ============================================
# NEON SETTINGS EXPLANATION
# ============================================
#
# 1. pgbouncer=true
#    - Enables connection pooling
#    - Prevents cold starts
#    - Reduces latency from 15s → 0.2s
#
# 2. connect_timeout=15
#    - Max time to establish connection
#    - Default is 60s (too long!)
#
# 3. connection_limit=10
#    - Limits concurrent connections per process
#    - Prevents "too many connections" error
#    - Vercel: Each function = separate process
#
# 4. DIRECT_URL
#    - Used for migrations only
#    - Cannot use pooled connection for schema changes
#
# ============================================
# PERFORMANCE COMPARISON
# ============================================
#
# Direct Connection (No Pooling):
# - Cold start: 5-15s ❌
# - Warm: 0.5-2s
# - After 5min idle: Cold start again
#
# Pooled Connection (pgbouncer=true):
# - Always warm: 0.1-0.3s ✅
# - No cold start
# - Consistent performance
#
# ============================================
# MIGRATION COMMANDS
# ============================================
#
# Use DIRECT_URL for migrations:
# DATABASE_URL=$DIRECT_URL npx prisma migrate deploy
#
# Use pooled for runtime:
# DATABASE_URL=$DATABASE_URL npm start
#
